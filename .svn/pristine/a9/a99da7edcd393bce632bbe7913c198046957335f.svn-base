<%@page import="org.json.simple.parser.ParseException"%>
<%@page import="org.json.simple.JSONObject"%>
<%@page import="org.json.simple.parser.JSONParser"%>
<%@page import="vo.PlayerInfo"%>
<%@page import="dao.DAO_PlayerInfo"%>
<%@page import="org.json.simple.JSONArray"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<fmt:requestEncoding value="EUC-KR" />
<c:set var="path" value="${pageContext.request.contextPath}" />
<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>justification</title>
<style type="text/css">
</style>
<script src="${path}/com/jquery-1.10.2.js"></script>

</head>
<body>
	<%
		DAO_PlayerInfo dao = new DAO_PlayerInfo();

		String result = (request.getParameter("result") != null) ? request.getParameter("result") : "";
		System.out.println("result: " + result);
		try {
			JSONParser jsonParser = new JSONParser();
			//JSON데이터를 넣어 JSON Object 로 만들어 준다.
			JSONObject jsonObject = (JSONObject) jsonParser.parse(result);
			//books의 배열을 추출
			JSONArray playerArray = (JSONArray) jsonObject.get("playersInfo");
			for (int i = 0; i < playerArray.size(); i++) {
				
				System.out.println("=player " + i + " ===========================================");
				PlayerInfo upt= new PlayerInfo();
				//배열 안에 있는것도 JSON형식 이기 때문에 JSON Object 로 추출
				JSONObject playerObject = (JSONObject) playerArray.get(i);
				
				//JSON name으로 추출
				upt.setPid((String)playerObject.get("id"));
				upt.setcurMoney(Double.parseDouble(playerObject.get("curMoney").toString()));
				System.out.println("playerInfo: id==>" + playerObject.get("id"));
				System.out.println("playerInfo: curMoney==>" + playerObject.get("curMoney"));
				System.out.println("playerInfo: playerBetMoney==>" + playerObject.get("playerBetMoney"));
				System.out.println("playerInfo: horseNumber==>" + playerObject.get("hnum"));
				dao.updatePlayer(upt, 2);
			}

		} catch (ParseException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	%>

</body>
<script type="text/javascript">
	$(document).ready(function() {
	})
</script>
</html>